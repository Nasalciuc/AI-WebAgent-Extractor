# Agent Memory - Darwin.md Scraping Intelligence

*Last Updated: October 15, 2025*

## Current Session Status
- **Date**: October 15, 2025
- **Active Mode**: Darwin Agent Framework
- **Total Sessions**: 47
- **Success Rate**: 82.3%
- **Last Successful Extraction**: October 15, 2025 14:32 UTC

---

## Method Success Rates

| Method | Success Rate | Total Attempts | Avg Response Time (s) | Last Updated |
|--------|-------------|----------------|---------------------|--------------|
| drissionpage | 85% | 234 | 2.3 | 2025-10-15 |
| selenium | 75% | 189 | 4.1 | 2025-10-15 |
| beautifulsoup | 65% | 156 | 1.8 | 2025-10-15 |
| auto | 80% | 298 | 2.9 | 2025-10-15 |

### Method Performance Notes:
- **DrissionPage**: Best overall performance, handles dynamic content well
- **Selenium**: Reliable but slower, good for complex JavaScript interactions
- **BeautifulSoup**: Fast but limited with dynamic content, best for static pages
- **Auto**: Intelligent fallback chain provides good balance

---

## Recent Learnings

### 2025-10-15 15:45 UTC
**Topic**: Darwin.md Product Page Structure
- Product pages follow consistent pattern: `/product/{product-id}`
- Price information always in `.price-current` class
- Stock status in `data-stock` attribute
- Image galleries use lazy loading with `data-src` attributes

### 2025-10-15 12:30 UTC
**Topic**: Category Navigation Optimization  
- Category URLs follow pattern: `/category/{category-slug}`
- Pagination uses `?page={n}` parameter
- Maximum 24 products per page
- Category filters available via URL parameters

### 2025-10-14 16:22 UTC
**Topic**: Rate Limiting Behavior
- Darwin.md implements 429 responses after 50 requests/minute
- Optimal delay: 1.2-1.5 seconds between requests
- User-Agent rotation helps avoid detection
- Peak traffic: 9-17 UTC (avoid during these hours)

### 2025-10-14 09:15 UTC
**Topic**: Currency and Pricing Patterns
- All prices in MDL (Moldovan Leu)
- Discount prices shown with `.price-old` and `.price-new` classes
- Special offers marked with `.promotion-badge`
- VAT always included in displayed prices

---

## Failed URLs History

### Recent Failures (Last 7 Days)
```
2025-10-15 14:28 - https://darwin.md/product/laptop-gaming-asus-rog - 404 Not Found
2025-10-15 11:45 - https://darwin.md/category/smartphones?page=15 - Empty page
2025-10-14 16:30 - https://darwin.md/product/iphone-15-pro - Rate limited (429)
2025-10-14 13:22 - https://darwin.md/search?q=gaming+mouse - Invalid search results
2025-10-13 10:15 - https://darwin.md/product/tablet-samsung-tab - Out of stock redirect
```

### Common Failure Patterns:
- **Product Removal**: URLs return 404 when products discontinued
- **Pagination Issues**: Pages beyond actual content return empty results
- **Rate Limiting**: 429 errors during peak hours (9-17 UTC)
- **Search Limitations**: Complex queries sometimes return invalid results
- **Stock Redirects**: Out-of-stock items redirect to category pages

---

## Best Performing Configurations

### Optimal Scraping Configuration
```yaml
method: drissionpage
delay_range: [1.2, 1.5]
timeout: 10
retry_attempts: 3
user_agent_rotation: true
headers:
  Accept-Language: "ro-RO,ro;q=0.9,en;q=0.8"
  Accept-Encoding: "gzip, deflate, br"
```

### High-Success URL Patterns
- Product pages: `https://darwin.md/product/{id}` - 92% success
- Category pages: `https://darwin.md/category/{slug}` - 88% success  
- Search results: `https://darwin.md/search?q={query}` - 76% success
- Brand pages: `https://darwin.md/brand/{brand}` - 85% success

### Timing Optimization
- **Best Hours**: 18:00-08:00 UTC (off-peak)
- **Worst Hours**: 09:00-17:00 UTC (peak traffic)
- **Optimal Batch Size**: 25-30 URLs per session
- **Recovery Time**: 5-10 minutes between large batches

---

## Known Issues and Workarounds

### Issue: Dynamic Price Loading
**Problem**: Prices sometimes load via JavaScript after initial page load
**Workaround**: 
- Use DrissionPage with 2-second wait after page load
- Check for `.price-loading` class and wait for removal
- Fallback to API endpoint: `/api/product/{id}/price`

### Issue: Image Lazy Loading
**Problem**: Product images use lazy loading, `src` attribute empty initially
**Workaround**:
- Target `data-src` attribute instead of `src`
- Scroll to image element to trigger loading
- Use high-resolution variants when available: `data-src-hd`

### Issue: Category Pagination Limits
**Problem**: Category pages show max 24 items, pagination not always reliable
**Workaround**:
- Check for "Next" button existence before attempting pagination
- Use `total-items` metadata to calculate expected pages
- Implement pagination validation with item count verification

### Issue: Search Result Inconsistencies  
**Problem**: Search functionality returns inconsistent results for same query
**Workaround**:
- Use category filtering instead of general search when possible
- Implement result validation by checking product relevance
- Cache successful search patterns for reuse

### Issue: Moldova-Specific Content
**Problem**: Some content appears only for Moldova IP addresses
**Workaround**:
- Use Moldova-based proxy when available
- Set `Accept-Language: ro-RO` header
- Include Moldova-specific user agents in rotation

---

## Site Structure Intelligence

### URL Patterns
```
Products:     /product/{slug}-{id}
Categories:   /category/{category-slug}
Brands:       /brand/{brand-slug}  
Search:       /search?q={query}&category={cat}&sort={sort}
API:          /api/v1/{endpoint}
```

### Key CSS Selectors
```css
/* Product Information */
.product-title          /* Product name */
.price-current         /* Current price */  
.price-old             /* Original price (if discounted) */
.product-description   /* Product description */
.product-specs         /* Technical specifications */
.stock-status          /* Availability status */

/* Category Pages */
.product-grid          /* Product listing container */
.product-card          /* Individual product card */
.pagination-nav        /* Pagination controls */
.category-filters      /* Filter sidebar */

/* Navigation */
.main-nav              /* Main navigation menu */
.breadcrumb            /* Breadcrumb navigation */
.category-menu         /* Category dropdown */
```

### Performance Benchmarks
- Average page load: 2.1 seconds
- Search response: 0.8 seconds
- API response: 0.3 seconds  
- Image loading: 1.5 seconds (lazy loaded)

---

## Statistical Analysis

### Extraction Success by Category
- **Electronics**: 88% (1,234 products)
- **Clothing**: 82% (987 products)
- **Home & Garden**: 91% (756 products)
- **Sports**: 79% (543 products)
- **Books**: 95% (321 products)

### Error Distribution
- Network timeouts: 35%
- Rate limiting: 28%
- Content structure changes: 20%
- JavaScript loading issues: 12%
- Other: 5%

### Recovery Success Rates
- Immediate retry: 45%
- Delayed retry (5min): 72%
- Method switching: 68%
- Manual intervention: 95%

---

*This memory file is automatically updated by the Darwin Agent system. Manual edits should include timestamp and source attribution.*